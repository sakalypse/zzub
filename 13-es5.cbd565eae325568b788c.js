function _defineProperties(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function _createClass(n,e,t){return e&&_defineProperties(n.prototype,e),t&&_defineProperties(n,t),n}function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{rZCR:function(n,e,t){"use strict";t.r(e);var r=t("8Y7J"),l=function n(){_classCallCheck(this,n)},u=t("pMnS"),o=t("MKJQ"),i=t("sZkV"),s=t("SVse"),c=t("mrSG"),a=t("IheW"),h=t("qXBG"),d=t("VdwR"),b=t("qfBg"),f=t("B68i"),m=t("T90T"),p=function(){function n(e,t,r,l,u,o,i,s,c,h,d){var b=this;_classCallCheck(this,n),this.authService=e,this.gameService=t,this.userService=r,this.packService=l,this.http=u,this.router=i,this.activatedRoute=s,this.alertController=c,this.toastController=h,this.socket=d,this.indexCurrentPack=0,this.indexCurrentRound=0,this.showQuestion=!0,this.http=new a.c(o),s.params.subscribe((function(n){b.init()}))}return _createClass(n,[{key:"ngOnInit",value:function(){}},{key:"init",value:function(){return c.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function n(){var e=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.authService.getLoggedUser().userId;case 2:return this.userId=n.sent,this.roomCode=this.activatedRoute.snapshot.paramMap.get("code"),n.next=6,this.gameService.getGameByCode(this.roomCode);case 6:this.room=n.sent,this.owner=this.room.owner.userId==this.userId,this.listPlayerScore=[],this.room.players.forEach((function(n){e.listPlayerScore.push({userId:n.userId,username:n.username,score:0})})),console.log(this.listPlayerScore),this.initPlayer(),this.owner&&this.initHost();case 13:case"end":return n.stop()}}),n,this)})))}},{key:"initPlayer",value:function(){return c.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function n(){var e=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:this.socket.fromEvent("sendQuestion").subscribe((function(n){return c.__awaiter(e,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.showQuestion=!0,this.canAnswer=!0,this.currentQuestion=n.question,this.currentChoices=n.choices;case 1:case"end":return e.stop()}}),e,this)})))})),this.socket.fromEvent("endOfRound").subscribe((function(n){return c.__awaiter(e,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(n.userId),t=this.listPlayerScore.find((function(e){return e.userId==n.userId})),console.log(t),t.score++,this.showQuestion=!1;case 3:case"end":return e.stop()}}),e,this)})))}));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"initHost",value:function(){return c.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function n(){var e=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:this.currentPack=this.room.packs[this.indexCurrentPack],this.socket.fromEvent("playerSendChoice").subscribe((function(n){return c.__awaiter(e,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.currentChoices.find((function(n){return 1==n.isAnswer})).choiceId==n.choiceId?this.socket.emit("endOfRound",{roomCode:this.roomCode,userId:n.userId}):this.canAnswer=!1;case 1:case"end":return e.stop()}}),e,this)})))}));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"sendNextQuestion",value:function(){return c.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function n(){var e,t,r,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.owner){n.next=8;break}if(!(this.indexCurrentRound>=this.currentPack.rounds.length)){n.next=5;break}if(console.log("next pack"),!(this.indexCurrentPack>=this.room.packs.length-1)){n.next=4;break}return n.abrupt("return",void console.log(this.listPlayerScore.sort((function(n,e){return n.score>e.score?1:-1}))[this.listPlayerScore.length-1]));case 4:this.currentPack=this.room.packs[++this.indexCurrentPack],this.indexCurrentRound=0;case 5:for(e=this.currentPack.rounds[this.indexCurrentRound++],t=e.choices.length-1;t>0;t--)r=Math.floor(Math.random()*(t+1)),l=[e.choices[r],e.choices[t]],e.choices[t]=l[0],e.choices[r]=l[1];this.socket.emit("sendQuestion",{roomCode:this.roomCode,question:e.question,choices:e.choices});case 8:case"end":return n.stop()}}),n,this)})))}},{key:"playerSendChoice",value:function(n){return c.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.canAnswer&&this.socket.emit("playerSendChoice",{roomCode:this.roomCode,choiceId:n,userId:this.userId});case 1:case"end":return e.stop()}}),e,this)})))}},{key:"exitRoom",value:function(){return c.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.gameService.removeUserToGame(this.room.gameId,this.userId);case 2:if(n.t0=this.authService.getLoggedUser().role==f.a.guest,!n.t0){n.next=7;break}return n.next=6,this.userService.deleteGuest(this.authService.getLoggedUser().userId);case 6:this.authService.clearStorage();case 7:this.socket.emit("quitGame",this.userId,this.roomCode),this.router.navigate(["/homepage/"]);case 9:case"end":return n.stop()}}),n,this)})))}},{key:"deleteRoom",value:function(){return c.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.gameService.deleteGame(this.room.gameId);case 2:this.socket.emit("killGame",this.roomCode),this.router.navigate(["/homepage/"]);case 4:case"end":return n.stop()}}),n,this)})))}}]),n}(),v=t("iInd"),g=t("RH9n"),k=r.nb({encapsulation:0,styles:[[""]],data:{}});function w(n){return r.Ib(0,[(n()(),r.pb(0,0,null,null,1,"button",[],null,[[null,"click"]],(function(n,e,t){var r=!0;return"click"===e&&(r=!1!==n.component.sendNextQuestion()&&r),r}),null,null)),(n()(),r.Hb(-1,null,["Send next question"]))],null,null)}function x(n){return r.Ib(0,[(n()(),r.pb(0,0,null,null,1,"button",[],null,[[null,"click"]],(function(n,e,t){var r=!0;return"click"===e&&(r=!1!==n.component.deleteRoom()&&r),r}),null,null)),(n()(),r.Hb(-1,null,["Delete room"]))],null,null)}function I(n){return r.Ib(0,[(n()(),r.pb(0,0,null,null,1,"button",[],null,[[null,"click"]],(function(n,e,t){var r=!0;return"click"===e&&(r=!1!==n.component.exitRoom()&&r),r}),null,null)),(n()(),r.Hb(-1,null,["Exit room"]))],null,null)}function C(n){return r.Ib(0,[(n()(),r.pb(0,0,null,null,2,"div",[],null,null,null,null,null)),(n()(),r.pb(1,0,null,null,1,"button",[],null,[[null,"click"]],(function(n,e,t){var r=!0;return"click"===e&&(r=!1!==n.component.playerSendChoice(n.context.$implicit.choiceId)&&r),r}),null,null)),(n()(),r.Hb(2,null,["",""]))],null,(function(n,e){n(e,2,0,e.context.$implicit.choice)}))}function R(n){return r.Ib(0,[(n()(),r.pb(0,0,null,null,7,"div",[],null,null,null,null,null)),(n()(),r.pb(1,0,null,null,4,"ion-card",[],null,null,null,o.x,o.c)),r.ob(2,49152,null,0,i.l,[r.h,r.k,r.x],null,null),(n()(),r.pb(3,0,null,0,2,"ion-card-content",[],null,null,null,o.w,o.d)),r.ob(4,49152,null,0,i.m,[r.h,r.k,r.x],null,null),(n()(),r.Hb(5,0,[" "," "])),(n()(),r.eb(16777216,null,null,1,null,C)),r.ob(7,278528,null,0,s.i,[r.M,r.J,r.q],{ngForOf:[0,"ngForOf"]},null)],(function(n,e){n(e,7,0,e.component.currentChoices)}),(function(n,e){n(e,5,0,e.component.currentQuestion)}))}function y(n){return r.Ib(0,[(n()(),r.pb(0,0,null,null,4,"ion-card",[],null,null,null,o.x,o.c)),r.ob(1,49152,null,0,i.l,[r.h,r.k,r.x],null,null),(n()(),r.pb(2,0,null,0,2,"ion-card-content",[],null,null,null,o.w,o.d)),r.ob(3,49152,null,0,i.m,[r.h,r.k,r.x],null,null),(n()(),r.Hb(4,0,[" "," : "," "]))],null,(function(n,e){n(e,4,0,e.context.$implicit.username,e.context.$implicit.score)}))}function _(n){return r.Ib(0,[(n()(),r.pb(0,0,null,null,2,"div",[],null,null,null,null,null)),(n()(),r.eb(16777216,null,null,1,null,y)),r.ob(2,278528,null,0,s.i,[r.M,r.J,r.q],{ngForOf:[0,"ngForOf"]},null)],(function(n,e){n(e,2,0,e.component.listPlayerScore)}),null)}function S(n){return r.Ib(0,[(n()(),r.pb(0,0,null,null,6,"ion-header",[],null,null,null,o.B,o.h)),r.ob(1,49152,null,0,i.A,[r.h,r.k,r.x],null,null),(n()(),r.pb(2,0,null,0,4,"ion-toolbar",[],null,null,null,o.N,o.t)),r.ob(3,49152,null,0,i.yb,[r.h,r.k,r.x],null,null),(n()(),r.pb(4,0,null,0,2,"ion-title",[],null,null,null,o.L,o.r)),r.ob(5,49152,null,0,i.wb,[r.h,r.k,r.x],null,null),(n()(),r.Hb(-1,0,["game"])),(n()(),r.pb(7,0,null,null,13,"ion-content",[],null,null,null,o.z,o.f)),r.ob(8,49152,null,0,i.t,[r.h,r.k,r.x],null,null),(n()(),r.pb(9,0,null,0,1,"div",[],null,null,null,null,null)),(n()(),r.Hb(10,null,["Lobby : ",""])),(n()(),r.eb(16777216,null,0,1,null,w)),r.ob(12,16384,null,0,s.j,[r.M,r.J],{ngIf:[0,"ngIf"]},null),(n()(),r.eb(16777216,null,0,1,null,x)),r.ob(14,16384,null,0,s.j,[r.M,r.J],{ngIf:[0,"ngIf"]},null),(n()(),r.eb(16777216,null,0,1,null,I)),r.ob(16,16384,null,0,s.j,[r.M,r.J],{ngIf:[0,"ngIf"]},null),(n()(),r.eb(16777216,null,0,1,null,R)),r.ob(18,16384,null,0,s.j,[r.M,r.J],{ngIf:[0,"ngIf"]},null),(n()(),r.eb(16777216,null,0,1,null,_)),r.ob(20,16384,null,0,s.j,[r.M,r.J],{ngIf:[0,"ngIf"]},null)],(function(n,e){var t=e.component;n(e,12,0,t.owner),n(e,14,0,t.owner),n(e,16,0,!t.owner),n(e,18,0,t.showQuestion),n(e,20,0,!t.showQuestion)}),(function(n,e){n(e,10,0,e.component.roomCode)}))}var P=r.lb("app-game",p,(function(n){return r.Ib(0,[(n()(),r.pb(0,0,null,null,1,"app-game",[],null,null,null,S,k)),r.ob(1,114688,null,0,p,[h.a,d.a,b.a,m.a,a.c,a.b,v.m,v.a,i.a,i.Jb,g.a],null,null)],(function(n,e){n(e,1,0)}),null)}),{},{},[]),z=t("s7LF"),M=function n(){_classCallCheck(this,n)};t.d(e,"GamePageModuleNgFactory",(function(){return J}));var J=r.mb(l,[],(function(n){return r.yb([r.zb(512,r.j,r.X,[[8,[u.a,P]],[3,r.j],r.v]),r.zb(4608,s.l,s.k,[r.s,[2,s.w]]),r.zb(4608,z.t,z.t,[]),r.zb(4608,i.b,i.b,[r.x,r.g]),r.zb(4608,i.Cb,i.Cb,[i.b,r.j,r.p]),r.zb(4608,i.Fb,i.Fb,[i.b,r.j,r.p]),r.zb(1073742336,s.b,s.b,[]),r.zb(1073742336,z.s,z.s,[]),r.zb(1073742336,z.i,z.i,[]),r.zb(1073742336,i.Ab,i.Ab,[]),r.zb(1073742336,v.o,v.o,[[2,v.t],[2,v.m]]),r.zb(1073742336,M,M,[]),r.zb(1073742336,l,l,[]),r.zb(1024,v.k,(function(){return[[{path:"",component:p}]]}),[])])}))}}]);