function _defineProperties(n,e){for(var t=0;t<e.length;t++){var l=e[t];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(n,l.key,l)}}function _createClass(n,e,t){return e&&_defineProperties(n.prototype,e),t&&_defineProperties(n,t),n}function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{rZCR:function(n,e,t){"use strict";t.r(e);var l=t("8Y7J"),u=function n(){_classCallCheck(this,n)},r=t("pMnS"),i=t("SVse"),o=t("MKJQ"),s=t("sZkV"),c=t("mrSG"),a=t("IheW"),h=t("qXBG"),d=t("VdwR"),f=t("qfBg"),p=t("B68i"),b=t("T90T"),m=function(n){return n[n.noExtra=0]="noExtra",n[n.audio=1]="audio",n[n.video=2]="video",n[n.img=3]="img",n}({}),v=function(){function n(e,t,l,u,r,i,o,s,c,h,d){var f=this;_classCallCheck(this,n),this.authService=e,this.gameService=t,this.userService=l,this.packService=u,this.http=r,this.router=o,this.activatedRoute=s,this.alertController=c,this.toastController=h,this.socket=d,this.enumExtraType=m,this.indexCurrentPack=0,this.indexCurrentRound=0,this.showQuestion=!1,this.http=new a.c(i),s.params.subscribe((function(n){f.init()}))}return _createClass(n,[{key:"ngOnInit",value:function(){}},{key:"init",value:function(){return c.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function n(){var e=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.authService.getLoggedUser().userId;case 2:return this.userId=n.sent,this.roomCode=this.activatedRoute.snapshot.paramMap.get("code"),n.next=6,this.gameService.getGameByCode(this.roomCode);case 6:this.room=n.sent,this.owner=this.room.owner.userId==this.userId,this.listPlayerScore=[],this.room.players.forEach((function(n){e.listPlayerScore.push({userId:n.userId,username:n.username,score:0})})),this.initPlayer(),this.owner&&this.initHost();case 12:case"end":return n.stop()}}),n,this)})))}},{key:"initPlayer",value:function(){return c.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function n(){var e=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:this.socket.fromEvent("sendQuestion").subscribe((function(n){return c.__awaiter(e,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.showQuestion=!0,this.canAnswer=!0,this.roundIsMultipleChoice=n.roundIsMultipleChoice,this.currentQuestion=n.question,this.currentChoices=n.choices,this.currentExtra=n.extra;case 1:case"end":return e.stop()}}),e,this)})))})),this.socket.fromEvent("endOfRound").subscribe((function(n){return c.__awaiter(e,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.listPlayerScore.find((function(e){return e.userId==n.userId})).score++,this.showQuestion=!1;case 1:case"end":return e.stop()}}),e,this)})))})),this.socket.fromEvent("playerWrong").subscribe((function(n){return c.__awaiter(e,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.userId==n.userId&&(this.canAnswer=!1);case 1:case"end":return e.stop()}}),e,this)})))}));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"initHost",value:function(){return c.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function n(){var e=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:this.currentPack=this.room.packs[this.indexCurrentPack],this.socket.fromEvent("playerSendChoice").subscribe((function(n){return c.__awaiter(e,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.currentChoices.find((function(n){return 1==n.isAnswer})).choiceId==n.choiceId?this.socket.emit("endOfRound",{roomCode:this.roomCode,userId:n.userId}):this.socket.emit("playerWrong",{roomCode:this.roomCode,userId:n.userId});case 1:case"end":return e.stop()}}),e,this)})))})),this.socket.fromEvent("playerSendInputChoice").subscribe((function(n){return c.__awaiter(e,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.currentChoices.find((function(n){return 1==n.isAnswer})).choice.toLowerCase()==n.inputChoice.toLowerCase()?this.socket.emit("endOfRound",{roomCode:this.roomCode,userId:n.userId}):this.socket.emit("playerWrong",{roomCode:this.roomCode,userId:n.userId});case 1:case"end":return e.stop()}}),e,this)})))}));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"sendNextQuestion",value:function(){return c.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function n(){var e,t,l,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.owner){n.next=8;break}if(!(this.indexCurrentRound>=this.currentPack.rounds.length)){n.next=5;break}if(!(this.indexCurrentPack>=this.room.packs.length-1)){n.next=4;break}return n.abrupt("return");case 4:this.currentPack=this.room.packs[++this.indexCurrentPack],this.indexCurrentRound=0;case 5:if((e=this.currentPack.rounds[this.indexCurrentRound++]).isMultipleChoice)for(t=e.choices.length-1;t>0;t--)l=Math.floor(Math.random()*(t+1)),u=[e.choices[l],e.choices[t]],e.choices[t]=u[0],e.choices[l]=u[1];this.socket.emit("sendQuestion",{roomCode:this.roomCode,question:e.question,roundIsMultipleChoice:e.isMultipleChoice,choices:e.choices,extra:e.extra});case 8:case"end":return n.stop()}}),n,this)})))}},{key:"playerSendChoice",value:function(n){return c.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.canAnswer&&this.socket.emit("playerSendChoice",{roomCode:this.roomCode,choiceId:n,userId:this.userId});case 1:case"end":return e.stop()}}),e,this)})))}},{key:"playerSendInputChoice",value:function(n){return c.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.canAnswer&&this.socket.emit("playerSendInputChoice",{roomCode:this.roomCode,inputChoice:n,userId:this.userId});case 1:case"end":return e.stop()}}),e,this)})))}},{key:"exitRoom",value:function(){return c.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.gameService.removeUserToGame(this.room.gameId,this.userId);case 2:if(n.t0=this.authService.getLoggedUser().role==p.a.guest,!n.t0){n.next=7;break}return n.next=6,this.userService.deleteGuest(this.authService.getLoggedUser().userId);case 6:this.authService.clearStorage();case 7:this.socket.emit("quitGame",this.userId,this.roomCode),this.router.navigate(["/"]);case 9:case"end":return n.stop()}}),n,this)})))}},{key:"deleteRoom",value:function(){return c.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.gameService.deleteGame(this.room.gameId);case 2:this.socket.emit("killGame",this.roomCode),this.router.navigate(["/"]);case 4:case"end":return n.stop()}}),n,this)})))}}]),n}(),g=t("iInd"),k=t("RH9n"),w=l.nb({encapsulation:0,styles:[[""]],data:{}});function I(n){return l.Ib(0,[(n()(),l.pb(0,0,null,null,1,"button",[],null,[[null,"click"]],(function(n,e,t){var l=!0;return"click"===e&&(l=!1!==n.component.sendNextQuestion()&&l),l}),null,null)),(n()(),l.Hb(-1,null,["Send next question"]))],null,null)}function C(n){return l.Ib(0,[(n()(),l.pb(0,0,null,null,1,"button",[],null,[[null,"click"]],(function(n,e,t){var l=!0;return"click"===e&&(l=!1!==n.component.deleteRoom()&&l),l}),null,null)),(n()(),l.Hb(-1,null,["Delete room"]))],null,null)}function x(n){return l.Ib(0,[(n()(),l.pb(0,0,null,null,1,"button",[],null,[[null,"click"]],(function(n,e,t){var l=!0;return"click"===e&&(l=!1!==n.component.exitRoom()&&l),l}),null,null)),(n()(),l.Hb(-1,null,["Exit room"]))],null,null)}function R(n){return l.Ib(0,[(n()(),l.pb(0,0,null,null,2,"div",[],null,null,null,null,null)),(n()(),l.pb(1,0,null,null,1,"button",[],null,[[null,"click"]],(function(n,e,t){var l=!0;return"click"===e&&(l=!1!==n.component.playerSendChoice(n.context.$implicit.choiceId)&&l),l}),null,null)),(n()(),l.Hb(2,null,["",""]))],null,(function(n,e){n(e,2,0,e.context.$implicit.choice)}))}function y(n){return l.Ib(0,[(n()(),l.pb(0,0,null,null,2,null,null,null,null,null,null,null)),(n()(),l.eb(16777216,null,null,1,null,R)),l.ob(2,278528,null,0,i.i,[l.M,l.J,l.q],{ngForOf:[0,"ngForOf"]},null),(n()(),l.eb(0,null,null,0))],(function(n,e){n(e,2,0,e.component.currentChoices)}),null)}function _(n){return l.Ib(0,[(n()(),l.pb(0,0,null,null,3,null,null,null,null,null,null,null)),(n()(),l.pb(1,0,[["inputChoice",1]],null,0,"input",[["type","text"]],null,null,null,null,null)),(n()(),l.pb(2,0,null,null,1,"button",[],null,[[null,"click"]],(function(n,e,t){var u=!0;return"click"===e&&(u=!1!==n.component.playerSendInputChoice(l.Bb(n,1).value)&&u),u}),null,null)),(n()(),l.Hb(-1,null,["OK"]))],null,null)}function S(n){return l.Ib(0,[(n()(),l.pb(0,0,null,null,2,null,null,null,null,null,null,null)),(n()(),l.pb(1,0,null,null,1,"div",[["class","preview img-preview"]],null,null,null,null,null)),(n()(),l.pb(2,0,null,null,0,"img",[["alt",""]],[[8,"src",4]],null,null,null,null))],null,(function(n,e){n(e,2,0,e.component.currentExtra.url)}))}function M(n){return l.Ib(0,[(n()(),l.pb(0,0,null,null,11,"div",[],null,null,null,null,null)),(n()(),l.pb(1,0,null,null,4,"ion-card",[],null,null,null,o.x,o.c)),l.ob(2,49152,null,0,s.l,[l.h,l.k,l.x],null,null),(n()(),l.pb(3,0,null,0,2,"ion-card-content",[],null,null,null,o.w,o.d)),l.ob(4,49152,null,0,s.m,[l.h,l.k,l.x],null,null),(n()(),l.Hb(5,0,[" "," "])),(n()(),l.eb(16777216,null,null,1,null,y)),l.ob(7,16384,null,0,i.j,[l.M,l.J],{ngIf:[0,"ngIf"]},null),(n()(),l.eb(16777216,null,null,1,null,_)),l.ob(9,16384,null,0,i.j,[l.M,l.J],{ngIf:[0,"ngIf"]},null),(n()(),l.eb(16777216,null,null,1,null,S)),l.ob(11,16384,null,0,i.j,[l.M,l.J],{ngIf:[0,"ngIf"]},null)],(function(n,e){var t=e.component;n(e,7,0,t.roundIsMultipleChoice),n(e,9,0,!t.roundIsMultipleChoice),n(e,11,0,null!=t.currentExtra&&t.currentExtra.extraType==t.enumExtraType.img)}),(function(n,e){n(e,5,0,e.component.currentQuestion)}))}function P(n){return l.Ib(0,[(n()(),l.pb(0,0,null,null,4,"ion-card",[],null,null,null,o.x,o.c)),l.ob(1,49152,null,0,s.l,[l.h,l.k,l.x],null,null),(n()(),l.pb(2,0,null,0,2,"ion-card-content",[],null,null,null,o.w,o.d)),l.ob(3,49152,null,0,s.m,[l.h,l.k,l.x],null,null),(n()(),l.Hb(4,0,[" "," : "," "]))],null,(function(n,e){n(e,4,0,e.context.$implicit.username,e.context.$implicit.score)}))}function E(n){return l.Ib(0,[(n()(),l.pb(0,0,null,null,2,"div",[],null,null,null,null,null)),(n()(),l.eb(16777216,null,null,1,null,P)),l.ob(2,278528,null,0,i.i,[l.M,l.J,l.q],{ngForOf:[0,"ngForOf"]},null)],(function(n,e){n(e,2,0,e.component.listPlayerScore)}),null)}function z(n){return l.Ib(0,[(n()(),l.pb(0,0,null,null,6,"ion-header",[],null,null,null,o.B,o.h)),l.ob(1,49152,null,0,s.A,[l.h,l.k,l.x],null,null),(n()(),l.pb(2,0,null,0,4,"ion-toolbar",[],null,null,null,o.N,o.t)),l.ob(3,49152,null,0,s.yb,[l.h,l.k,l.x],null,null),(n()(),l.pb(4,0,null,0,2,"ion-title",[],null,null,null,o.L,o.r)),l.ob(5,49152,null,0,s.wb,[l.h,l.k,l.x],null,null),(n()(),l.Hb(-1,0,["game"])),(n()(),l.pb(7,0,null,null,13,"ion-content",[],null,null,null,o.z,o.f)),l.ob(8,49152,null,0,s.t,[l.h,l.k,l.x],null,null),(n()(),l.pb(9,0,null,0,1,"div",[],null,null,null,null,null)),(n()(),l.Hb(10,null,["Lobby : ",""])),(n()(),l.eb(16777216,null,0,1,null,I)),l.ob(12,16384,null,0,i.j,[l.M,l.J],{ngIf:[0,"ngIf"]},null),(n()(),l.eb(16777216,null,0,1,null,C)),l.ob(14,16384,null,0,i.j,[l.M,l.J],{ngIf:[0,"ngIf"]},null),(n()(),l.eb(16777216,null,0,1,null,x)),l.ob(16,16384,null,0,i.j,[l.M,l.J],{ngIf:[0,"ngIf"]},null),(n()(),l.eb(16777216,null,0,1,null,M)),l.ob(18,16384,null,0,i.j,[l.M,l.J],{ngIf:[0,"ngIf"]},null),(n()(),l.eb(16777216,null,0,1,null,E)),l.ob(20,16384,null,0,i.j,[l.M,l.J],{ngIf:[0,"ngIf"]},null)],(function(n,e){var t=e.component;n(e,12,0,t.owner),n(e,14,0,t.owner),n(e,16,0,!t.owner),n(e,18,0,t.showQuestion),n(e,20,0,!t.showQuestion)}),(function(n,e){n(e,10,0,e.component.roomCode)}))}var J=l.lb("app-game",v,(function(n){return l.Ib(0,[(n()(),l.pb(0,0,null,null,1,"app-game",[],null,null,null,z,w)),l.ob(1,114688,null,0,v,[h.a,d.a,f.a,b.a,a.c,a.b,g.m,g.a,s.a,s.Jb,k.a],null,null)],(function(n,e){n(e,1,0)}),null)}),{},{},[]),j=t("s7LF"),H=function n(){_classCallCheck(this,n)};t.d(e,"GamePageModuleNgFactory",(function(){return Q}));var Q=l.mb(u,[],(function(n){return l.yb([l.zb(512,l.j,l.X,[[8,[r.a,J]],[3,l.j],l.v]),l.zb(4608,i.l,i.k,[l.s,[2,i.w]]),l.zb(4608,j.t,j.t,[]),l.zb(4608,s.b,s.b,[l.x,l.g]),l.zb(4608,s.Cb,s.Cb,[s.b,l.j,l.p]),l.zb(4608,s.Fb,s.Fb,[s.b,l.j,l.p]),l.zb(1073742336,i.b,i.b,[]),l.zb(1073742336,j.s,j.s,[]),l.zb(1073742336,j.i,j.i,[]),l.zb(1073742336,s.Ab,s.Ab,[]),l.zb(1073742336,g.o,g.o,[[2,g.t],[2,g.m]]),l.zb(1073742336,H,H,[]),l.zb(1073742336,u,u,[]),l.zb(1024,g.k,(function(){return[[{path:"",component:v}]]}),[])])}))}}]);