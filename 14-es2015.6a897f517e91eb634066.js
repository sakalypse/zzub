(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{rZCR:function(n,l,u){"use strict";u.r(l);var e=u("8Y7J");class t{}var i=u("pMnS"),o=u("SVse"),r=u("MKJQ"),s=u("sZkV"),c=u("mrSG"),h=u("IheW"),a=u("qXBG"),d=u("VdwR"),b=u("qfBg"),m=u("B68i"),p=u("T90T"),f=function(n){return n[n.noExtra=0]="noExtra",n[n.audio=1]="audio",n[n.video=2]="video",n[n.img=3]="img",n}({});class v{constructor(n,l,u,e,t,i,o,r,s,c,a){this.authService=n,this.gameService=l,this.userService=u,this.packService=e,this.http=t,this.router=o,this.activatedRoute=r,this.alertController=s,this.toastController=c,this.socket=a,this.enumExtraType=f,this.indexCurrentPack=0,this.indexCurrentRound=0,this.showQuestion=!1,this.http=new h.c(i),r.params.subscribe(n=>{this.init()})}ngOnInit(){}init(){return c.__awaiter(this,void 0,void 0,(function*(){this.userId=yield this.authService.getLoggedUser().userId,this.roomCode=this.activatedRoute.snapshot.paramMap.get("code"),this.room=yield this.gameService.getGameByCode(this.roomCode),this.owner=this.room.owner.userId==this.userId,this.listPlayerScore=[],this.room.players.forEach(n=>{this.listPlayerScore.push({userId:n.userId,username:n.username,score:0})}),this.initPlayer(),this.owner&&this.initHost()}))}initPlayer(){return c.__awaiter(this,void 0,void 0,(function*(){this.socket.fromEvent("sendQuestion").subscribe(n=>c.__awaiter(this,void 0,void 0,(function*(){this.showQuestion=!0,this.canAnswer=!0,this.roundIsMultipleChoice=n.roundIsMultipleChoice,this.currentQuestion=n.question,this.currentChoices=n.choices,this.currentExtra=n.extra}))),this.socket.fromEvent("endOfRound").subscribe(n=>c.__awaiter(this,void 0,void 0,(function*(){this.listPlayerScore.find(l=>l.userId==n.userId).score++,this.showQuestion=!1}))),this.socket.fromEvent("playerWrong").subscribe(n=>c.__awaiter(this,void 0,void 0,(function*(){this.userId==n.userId&&(this.canAnswer=!1)})))}))}initHost(){return c.__awaiter(this,void 0,void 0,(function*(){this.currentPack=this.room.packs[this.indexCurrentPack],this.socket.fromEvent("playerSendChoice").subscribe(n=>c.__awaiter(this,void 0,void 0,(function*(){this.currentChoices.find(n=>1==n.isAnswer).choiceId==n.choiceId?this.socket.emit("endOfRound",{roomCode:this.roomCode,userId:n.userId}):this.socket.emit("playerWrong",{roomCode:this.roomCode,userId:n.userId})}))),this.socket.fromEvent("playerSendInputChoice").subscribe(n=>c.__awaiter(this,void 0,void 0,(function*(){this.currentChoices.find(n=>1==n.isAnswer).choice.toLowerCase()==n.inputChoice.toLowerCase()?this.socket.emit("endOfRound",{roomCode:this.roomCode,userId:n.userId}):this.socket.emit("playerWrong",{roomCode:this.roomCode,userId:n.userId})})))}))}sendNextQuestion(){return c.__awaiter(this,void 0,void 0,(function*(){if(this.owner){if(this.indexCurrentRound>=this.currentPack.rounds.length){if(this.indexCurrentPack>=this.room.packs.length-1)return;this.currentPack=this.room.packs[++this.indexCurrentPack],this.indexCurrentRound=0}var n=this.currentPack.rounds[this.indexCurrentRound++];if(n.isMultipleChoice)for(let l=n.choices.length-1;l>0;l--){const u=Math.floor(Math.random()*(l+1));[n.choices[l],n.choices[u]]=[n.choices[u],n.choices[l]]}this.socket.emit("sendQuestion",{roomCode:this.roomCode,question:n.question,roundIsMultipleChoice:n.isMultipleChoice,choices:n.choices,extra:n.extra})}}))}playerSendChoice(n){return c.__awaiter(this,void 0,void 0,(function*(){this.canAnswer&&this.socket.emit("playerSendChoice",{roomCode:this.roomCode,choiceId:n,userId:this.userId})}))}playerSendInputChoice(n){return c.__awaiter(this,void 0,void 0,(function*(){this.canAnswer&&this.socket.emit("playerSendInputChoice",{roomCode:this.roomCode,inputChoice:n,userId:this.userId})}))}exitRoom(){return c.__awaiter(this,void 0,void 0,(function*(){yield this.gameService.removeUserToGame(this.room.gameId,this.userId),this.authService.getLoggedUser().role==m.a.guest&&(yield this.userService.deleteGuest(this.authService.getLoggedUser().userId),this.authService.clearStorage()),this.socket.emit("quitGame",this.userId,this.roomCode),this.router.navigate(["/homepage/"])}))}deleteRoom(){return c.__awaiter(this,void 0,void 0,(function*(){yield this.gameService.deleteGame(this.room.gameId),this.socket.emit("killGame",this.roomCode),this.router.navigate(["/homepage/"])}))}}var I=u("iInd"),g=u("RH9n"),C=e.nb({encapsulation:0,styles:[[""]],data:{}});function k(n){return e.Ib(0,[(n()(),e.pb(0,0,null,null,1,"button",[],null,[[null,"click"]],(function(n,l,u){var e=!0;return"click"===l&&(e=!1!==n.component.sendNextQuestion()&&e),e}),null,null)),(n()(),e.Hb(-1,null,["Send next question"]))],null,null)}function w(n){return e.Ib(0,[(n()(),e.pb(0,0,null,null,1,"button",[],null,[[null,"click"]],(function(n,l,u){var e=!0;return"click"===l&&(e=!1!==n.component.deleteRoom()&&e),e}),null,null)),(n()(),e.Hb(-1,null,["Delete room"]))],null,null)}function x(n){return e.Ib(0,[(n()(),e.pb(0,0,null,null,1,"button",[],null,[[null,"click"]],(function(n,l,u){var e=!0;return"click"===l&&(e=!1!==n.component.exitRoom()&&e),e}),null,null)),(n()(),e.Hb(-1,null,["Exit room"]))],null,null)}function y(n){return e.Ib(0,[(n()(),e.pb(0,0,null,null,2,"div",[],null,null,null,null,null)),(n()(),e.pb(1,0,null,null,1,"button",[],null,[[null,"click"]],(function(n,l,u){var e=!0;return"click"===l&&(e=!1!==n.component.playerSendChoice(n.context.$implicit.choiceId)&&e),e}),null,null)),(n()(),e.Hb(2,null,["",""]))],null,(function(n,l){n(l,2,0,l.context.$implicit.choice)}))}function S(n){return e.Ib(0,[(n()(),e.pb(0,0,null,null,2,null,null,null,null,null,null,null)),(n()(),e.eb(16777216,null,null,1,null,y)),e.ob(2,278528,null,0,o.i,[e.M,e.J,e.q],{ngForOf:[0,"ngForOf"]},null),(n()(),e.eb(0,null,null,0))],(function(n,l){n(l,2,0,l.component.currentChoices)}),null)}function _(n){return e.Ib(0,[(n()(),e.pb(0,0,null,null,3,null,null,null,null,null,null,null)),(n()(),e.pb(1,0,[["inputChoice",1]],null,0,"input",[["type","text"]],null,null,null,null,null)),(n()(),e.pb(2,0,null,null,1,"button",[],null,[[null,"click"]],(function(n,l,u){var t=!0;return"click"===l&&(t=!1!==n.component.playerSendInputChoice(e.Bb(n,1).value)&&t),t}),null,null)),(n()(),e.Hb(-1,null,["OK"]))],null,null)}function M(n){return e.Ib(0,[(n()(),e.pb(0,0,null,null,2,null,null,null,null,null,null,null)),(n()(),e.pb(1,0,null,null,1,"div",[["class","preview img-preview"]],null,null,null,null,null)),(n()(),e.pb(2,0,null,null,0,"img",[["alt",""]],[[8,"src",4]],null,null,null,null))],null,(function(n,l){n(l,2,0,l.component.currentExtra.url)}))}function R(n){return e.Ib(0,[(n()(),e.pb(0,0,null,null,11,"div",[],null,null,null,null,null)),(n()(),e.pb(1,0,null,null,4,"ion-card",[],null,null,null,r.x,r.c)),e.ob(2,49152,null,0,s.l,[e.h,e.k,e.x],null,null),(n()(),e.pb(3,0,null,0,2,"ion-card-content",[],null,null,null,r.w,r.d)),e.ob(4,49152,null,0,s.m,[e.h,e.k,e.x],null,null),(n()(),e.Hb(5,0,[" "," "])),(n()(),e.eb(16777216,null,null,1,null,S)),e.ob(7,16384,null,0,o.j,[e.M,e.J],{ngIf:[0,"ngIf"]},null),(n()(),e.eb(16777216,null,null,1,null,_)),e.ob(9,16384,null,0,o.j,[e.M,e.J],{ngIf:[0,"ngIf"]},null),(n()(),e.eb(16777216,null,null,1,null,M)),e.ob(11,16384,null,0,o.j,[e.M,e.J],{ngIf:[0,"ngIf"]},null)],(function(n,l){var u=l.component;n(l,7,0,u.roundIsMultipleChoice),n(l,9,0,!u.roundIsMultipleChoice),n(l,11,0,null!=u.currentExtra&&u.currentExtra.extraType==u.enumExtraType.img)}),(function(n,l){n(l,5,0,l.component.currentQuestion)}))}function z(n){return e.Ib(0,[(n()(),e.pb(0,0,null,null,4,"ion-card",[],null,null,null,r.x,r.c)),e.ob(1,49152,null,0,s.l,[e.h,e.k,e.x],null,null),(n()(),e.pb(2,0,null,0,2,"ion-card-content",[],null,null,null,r.w,r.d)),e.ob(3,49152,null,0,s.m,[e.h,e.k,e.x],null,null),(n()(),e.Hb(4,0,[" "," : "," "]))],null,(function(n,l){n(l,4,0,l.context.$implicit.username,l.context.$implicit.score)}))}function E(n){return e.Ib(0,[(n()(),e.pb(0,0,null,null,2,"div",[],null,null,null,null,null)),(n()(),e.eb(16777216,null,null,1,null,z)),e.ob(2,278528,null,0,o.i,[e.M,e.J,e.q],{ngForOf:[0,"ngForOf"]},null)],(function(n,l){n(l,2,0,l.component.listPlayerScore)}),null)}function J(n){return e.Ib(0,[(n()(),e.pb(0,0,null,null,6,"ion-header",[],null,null,null,r.B,r.h)),e.ob(1,49152,null,0,s.A,[e.h,e.k,e.x],null,null),(n()(),e.pb(2,0,null,0,4,"ion-toolbar",[],null,null,null,r.N,r.t)),e.ob(3,49152,null,0,s.yb,[e.h,e.k,e.x],null,null),(n()(),e.pb(4,0,null,0,2,"ion-title",[],null,null,null,r.L,r.r)),e.ob(5,49152,null,0,s.wb,[e.h,e.k,e.x],null,null),(n()(),e.Hb(-1,0,["game"])),(n()(),e.pb(7,0,null,null,13,"ion-content",[],null,null,null,r.z,r.f)),e.ob(8,49152,null,0,s.t,[e.h,e.k,e.x],null,null),(n()(),e.pb(9,0,null,0,1,"div",[],null,null,null,null,null)),(n()(),e.Hb(10,null,["Lobby : ",""])),(n()(),e.eb(16777216,null,0,1,null,k)),e.ob(12,16384,null,0,o.j,[e.M,e.J],{ngIf:[0,"ngIf"]},null),(n()(),e.eb(16777216,null,0,1,null,w)),e.ob(14,16384,null,0,o.j,[e.M,e.J],{ngIf:[0,"ngIf"]},null),(n()(),e.eb(16777216,null,0,1,null,x)),e.ob(16,16384,null,0,o.j,[e.M,e.J],{ngIf:[0,"ngIf"]},null),(n()(),e.eb(16777216,null,0,1,null,R)),e.ob(18,16384,null,0,o.j,[e.M,e.J],{ngIf:[0,"ngIf"]},null),(n()(),e.eb(16777216,null,0,1,null,E)),e.ob(20,16384,null,0,o.j,[e.M,e.J],{ngIf:[0,"ngIf"]},null)],(function(n,l){var u=l.component;n(l,12,0,u.owner),n(l,14,0,u.owner),n(l,16,0,!u.owner),n(l,18,0,u.showQuestion),n(l,20,0,!u.showQuestion)}),(function(n,l){n(l,10,0,l.component.roomCode)}))}function P(n){return e.Ib(0,[(n()(),e.pb(0,0,null,null,1,"app-game",[],null,null,null,J,C)),e.ob(1,114688,null,0,v,[a.a,d.a,b.a,p.a,h.c,h.b,I.m,I.a,s.a,s.Jb,g.a],null,null)],(function(n,l){n(l,1,0)}),null)}var j=e.lb("app-game",v,P,{},{},[]),H=u("s7LF");class Q{}u.d(l,"GamePageModuleNgFactory",(function(){return q}));var q=e.mb(t,[],(function(n){return e.yb([e.zb(512,e.j,e.X,[[8,[i.a,j]],[3,e.j],e.v]),e.zb(4608,o.l,o.k,[e.s,[2,o.w]]),e.zb(4608,H.t,H.t,[]),e.zb(4608,s.b,s.b,[e.x,e.g]),e.zb(4608,s.Cb,s.Cb,[s.b,e.j,e.p]),e.zb(4608,s.Fb,s.Fb,[s.b,e.j,e.p]),e.zb(1073742336,o.b,o.b,[]),e.zb(1073742336,H.s,H.s,[]),e.zb(1073742336,H.i,H.i,[]),e.zb(1073742336,s.Ab,s.Ab,[]),e.zb(1073742336,I.o,I.o,[[2,I.t],[2,I.m]]),e.zb(1073742336,Q,Q,[]),e.zb(1073742336,t,t,[]),e.zb(1024,I.k,(function(){return[[{path:"",component:v}]]}),[])])}))}}]);