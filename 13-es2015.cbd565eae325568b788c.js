(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{rZCR:function(n,l,e){"use strict";e.r(l);var t=e("8Y7J");class o{}var u=e("pMnS"),i=e("MKJQ"),r=e("sZkV"),s=e("SVse"),c=e("mrSG"),h=e("IheW"),a=e("qXBG"),d=e("VdwR"),b=e("qfBg"),m=e("B68i"),f=e("T90T");class p{constructor(n,l,e,t,o,u,i,r,s,c,a){this.authService=n,this.gameService=l,this.userService=e,this.packService=t,this.http=o,this.router=i,this.activatedRoute=r,this.alertController=s,this.toastController=c,this.socket=a,this.indexCurrentPack=0,this.indexCurrentRound=0,this.showQuestion=!0,this.http=new h.c(u),r.params.subscribe(n=>{this.init()})}ngOnInit(){}init(){return c.__awaiter(this,void 0,void 0,(function*(){this.userId=yield this.authService.getLoggedUser().userId,this.roomCode=this.activatedRoute.snapshot.paramMap.get("code"),this.room=yield this.gameService.getGameByCode(this.roomCode),this.owner=this.room.owner.userId==this.userId,this.listPlayerScore=[],this.room.players.forEach(n=>{this.listPlayerScore.push({userId:n.userId,username:n.username,score:0})}),console.log(this.listPlayerScore),this.initPlayer(),this.owner&&this.initHost()}))}initPlayer(){return c.__awaiter(this,void 0,void 0,(function*(){this.socket.fromEvent("sendQuestion").subscribe(n=>c.__awaiter(this,void 0,void 0,(function*(){this.showQuestion=!0,this.canAnswer=!0,this.currentQuestion=n.question,this.currentChoices=n.choices}))),this.socket.fromEvent("endOfRound").subscribe(n=>c.__awaiter(this,void 0,void 0,(function*(){console.log(n.userId);let l=this.listPlayerScore.find(l=>l.userId==n.userId);console.log(l),l.score++,this.showQuestion=!1})))}))}initHost(){return c.__awaiter(this,void 0,void 0,(function*(){this.currentPack=this.room.packs[this.indexCurrentPack],this.socket.fromEvent("playerSendChoice").subscribe(n=>c.__awaiter(this,void 0,void 0,(function*(){this.currentChoices.find(n=>1==n.isAnswer).choiceId==n.choiceId?this.socket.emit("endOfRound",{roomCode:this.roomCode,userId:n.userId}):this.canAnswer=!1})))}))}sendNextQuestion(){return c.__awaiter(this,void 0,void 0,(function*(){if(this.owner){if(this.indexCurrentRound>=this.currentPack.rounds.length){if(console.log("next pack"),this.indexCurrentPack>=this.room.packs.length-1)return void console.log(this.listPlayerScore.sort((n,l)=>n.score>l.score?1:-1)[this.listPlayerScore.length-1]);this.currentPack=this.room.packs[++this.indexCurrentPack],this.indexCurrentRound=0}var n=this.currentPack.rounds[this.indexCurrentRound++];for(let l=n.choices.length-1;l>0;l--){const e=Math.floor(Math.random()*(l+1));[n.choices[l],n.choices[e]]=[n.choices[e],n.choices[l]]}this.socket.emit("sendQuestion",{roomCode:this.roomCode,question:n.question,choices:n.choices})}}))}playerSendChoice(n){return c.__awaiter(this,void 0,void 0,(function*(){this.canAnswer&&this.socket.emit("playerSendChoice",{roomCode:this.roomCode,choiceId:n,userId:this.userId})}))}exitRoom(){return c.__awaiter(this,void 0,void 0,(function*(){yield this.gameService.removeUserToGame(this.room.gameId,this.userId),this.authService.getLoggedUser().role==m.a.guest&&(yield this.userService.deleteGuest(this.authService.getLoggedUser().userId),this.authService.clearStorage()),this.socket.emit("quitGame",this.userId,this.roomCode),this.router.navigate(["/homepage/"])}))}deleteRoom(){return c.__awaiter(this,void 0,void 0,(function*(){yield this.gameService.deleteGame(this.room.gameId),this.socket.emit("killGame",this.roomCode),this.router.navigate(["/homepage/"])}))}}var v=e("iInd"),g=e("RH9n"),k=t.nb({encapsulation:0,styles:[[""]],data:{}});function I(n){return t.Ib(0,[(n()(),t.pb(0,0,null,null,1,"button",[],null,[[null,"click"]],(function(n,l,e){var t=!0;return"click"===l&&(t=!1!==n.component.sendNextQuestion()&&t),t}),null,null)),(n()(),t.Hb(-1,null,["Send next question"]))],null,null)}function w(n){return t.Ib(0,[(n()(),t.pb(0,0,null,null,1,"button",[],null,[[null,"click"]],(function(n,l,e){var t=!0;return"click"===l&&(t=!1!==n.component.deleteRoom()&&t),t}),null,null)),(n()(),t.Hb(-1,null,["Delete room"]))],null,null)}function C(n){return t.Ib(0,[(n()(),t.pb(0,0,null,null,1,"button",[],null,[[null,"click"]],(function(n,l,e){var t=!0;return"click"===l&&(t=!1!==n.component.exitRoom()&&t),t}),null,null)),(n()(),t.Hb(-1,null,["Exit room"]))],null,null)}function x(n){return t.Ib(0,[(n()(),t.pb(0,0,null,null,2,"div",[],null,null,null,null,null)),(n()(),t.pb(1,0,null,null,1,"button",[],null,[[null,"click"]],(function(n,l,e){var t=!0;return"click"===l&&(t=!1!==n.component.playerSendChoice(n.context.$implicit.choiceId)&&t),t}),null,null)),(n()(),t.Hb(2,null,["",""]))],null,(function(n,l){n(l,2,0,l.context.$implicit.choice)}))}function S(n){return t.Ib(0,[(n()(),t.pb(0,0,null,null,7,"div",[],null,null,null,null,null)),(n()(),t.pb(1,0,null,null,4,"ion-card",[],null,null,null,i.x,i.c)),t.ob(2,49152,null,0,r.l,[t.h,t.k,t.x],null,null),(n()(),t.pb(3,0,null,0,2,"ion-card-content",[],null,null,null,i.w,i.d)),t.ob(4,49152,null,0,r.m,[t.h,t.k,t.x],null,null),(n()(),t.Hb(5,0,[" "," "])),(n()(),t.eb(16777216,null,null,1,null,x)),t.ob(7,278528,null,0,s.i,[t.M,t.J,t.q],{ngForOf:[0,"ngForOf"]},null)],(function(n,l){n(l,7,0,l.component.currentChoices)}),(function(n,l){n(l,5,0,l.component.currentQuestion)}))}function y(n){return t.Ib(0,[(n()(),t.pb(0,0,null,null,4,"ion-card",[],null,null,null,i.x,i.c)),t.ob(1,49152,null,0,r.l,[t.h,t.k,t.x],null,null),(n()(),t.pb(2,0,null,0,2,"ion-card-content",[],null,null,null,i.w,i.d)),t.ob(3,49152,null,0,r.m,[t.h,t.k,t.x],null,null),(n()(),t.Hb(4,0,[" "," : "," "]))],null,(function(n,l){n(l,4,0,l.context.$implicit.username,l.context.$implicit.score)}))}function _(n){return t.Ib(0,[(n()(),t.pb(0,0,null,null,2,"div",[],null,null,null,null,null)),(n()(),t.eb(16777216,null,null,1,null,y)),t.ob(2,278528,null,0,s.i,[t.M,t.J,t.q],{ngForOf:[0,"ngForOf"]},null)],(function(n,l){n(l,2,0,l.component.listPlayerScore)}),null)}function P(n){return t.Ib(0,[(n()(),t.pb(0,0,null,null,6,"ion-header",[],null,null,null,i.B,i.h)),t.ob(1,49152,null,0,r.A,[t.h,t.k,t.x],null,null),(n()(),t.pb(2,0,null,0,4,"ion-toolbar",[],null,null,null,i.N,i.t)),t.ob(3,49152,null,0,r.yb,[t.h,t.k,t.x],null,null),(n()(),t.pb(4,0,null,0,2,"ion-title",[],null,null,null,i.L,i.r)),t.ob(5,49152,null,0,r.wb,[t.h,t.k,t.x],null,null),(n()(),t.Hb(-1,0,["game"])),(n()(),t.pb(7,0,null,null,13,"ion-content",[],null,null,null,i.z,i.f)),t.ob(8,49152,null,0,r.t,[t.h,t.k,t.x],null,null),(n()(),t.pb(9,0,null,0,1,"div",[],null,null,null,null,null)),(n()(),t.Hb(10,null,["Lobby : ",""])),(n()(),t.eb(16777216,null,0,1,null,I)),t.ob(12,16384,null,0,s.j,[t.M,t.J],{ngIf:[0,"ngIf"]},null),(n()(),t.eb(16777216,null,0,1,null,w)),t.ob(14,16384,null,0,s.j,[t.M,t.J],{ngIf:[0,"ngIf"]},null),(n()(),t.eb(16777216,null,0,1,null,C)),t.ob(16,16384,null,0,s.j,[t.M,t.J],{ngIf:[0,"ngIf"]},null),(n()(),t.eb(16777216,null,0,1,null,S)),t.ob(18,16384,null,0,s.j,[t.M,t.J],{ngIf:[0,"ngIf"]},null),(n()(),t.eb(16777216,null,0,1,null,_)),t.ob(20,16384,null,0,s.j,[t.M,t.J],{ngIf:[0,"ngIf"]},null)],(function(n,l){var e=l.component;n(l,12,0,e.owner),n(l,14,0,e.owner),n(l,16,0,!e.owner),n(l,18,0,e.showQuestion),n(l,20,0,!e.showQuestion)}),(function(n,l){n(l,10,0,l.component.roomCode)}))}function z(n){return t.Ib(0,[(n()(),t.pb(0,0,null,null,1,"app-game",[],null,null,null,P,k)),t.ob(1,114688,null,0,p,[a.a,d.a,b.a,f.a,h.c,h.b,v.m,v.a,r.a,r.Jb,g.a],null,null)],(function(n,l){n(l,1,0)}),null)}var R=t.lb("app-game",p,z,{},{},[]),M=e("s7LF");class J{}e.d(l,"GamePageModuleNgFactory",(function(){return Q}));var Q=t.mb(o,[],(function(n){return t.yb([t.zb(512,t.j,t.X,[[8,[u.a,R]],[3,t.j],t.v]),t.zb(4608,s.l,s.k,[t.s,[2,s.w]]),t.zb(4608,M.t,M.t,[]),t.zb(4608,r.b,r.b,[t.x,t.g]),t.zb(4608,r.Cb,r.Cb,[r.b,t.j,t.p]),t.zb(4608,r.Fb,r.Fb,[r.b,t.j,t.p]),t.zb(1073742336,s.b,s.b,[]),t.zb(1073742336,M.s,M.s,[]),t.zb(1073742336,M.i,M.i,[]),t.zb(1073742336,r.Ab,r.Ab,[]),t.zb(1073742336,v.o,v.o,[[2,v.t],[2,v.m]]),t.zb(1073742336,J,J,[]),t.zb(1073742336,o,o,[]),t.zb(1024,v.k,(function(){return[[{path:"",component:p}]]}),[])])}))}}]);